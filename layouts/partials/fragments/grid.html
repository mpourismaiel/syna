{{- $self := .self -}}
{{- $page_scratch := .page_scratch -}}

{{/* Slot information */}}
{{- $data := dict "page" $.page "content_fragment" $self -}}
{{- $slot := "column" -}}
{{- $slot_name := printf "%s/%s" .Name $slot -}}

{{/* Column information */}}
{{- $is_column_general := not (isset .Params "column") -}}
{{- $columns := .Params.column | default slice -}}
{{- $column_count := len $columns -}}

{{- $bg := .self.Scratch.Get "bg" }}

{{ "<!-- Grid -->" | safeHTML }}

{{- partial "helpers/container.html" (dict "start" true "in_slot" .in_slot "bg" $bg "Name" .Name "Params" .Params) -}}
  {{- partial "helpers/section-header.html" (dict "self" $self "bg" $bg "params" .Params) }}

  {{- partial "helpers/slot.html" (dict "root" $ "slot" $slot "data" $data "should_render" false) -}}
  {{- $slots := ($page_scratch.Get $slot_name) | default slice }}
  <div class="row">
    {{- range $index, $fragment := sort $slots "Params.weight" -}}
      {{- $col := mod $index ($column_count | default 1) -}}
      <div class="{{ cond $is_column_general (printf "col-sm-%d" ($.Params.column_span | default 3)) (index $columns $col).class }}">
        {{- partial "helpers/slot-renderer.html" (dict "page_scratch" $page_scratch "data" $data "root" $ "slot" $slot "fragment" $fragment) -}}
      </div>
    {{- end -}}  
  </div>
{{- partial "helpers/container.html" (dict "end" true "in_slot" .in_slot) -}}
